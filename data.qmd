---
title: Example datasets
---

Here we download and wrangle the example datasets used in our analyses.

```{r}
#| label: setup

library(haven)
library(tidyverse)
```

We will use two example datasets. The first is from "A primer on two-level dynamic structural equation models for intensive longitudinal data in Mplus" [@mcneishPrimerTwolevelDynamic2020]. Those data are available on the OSF (<https://osf.io/wuprx/>). Here we download, clean, and save the data for use in our analyses.

```{r}
#| label: mh-download

path <- "data/mh.zip"
url <- "https://files.osf.io/v1/resources/wuprx/providers/osfstorage/5bfc839601593f0016774697/?zip="
if (!file.exists(path)) {
  dir.create(dirname(path), showWarnings = FALSE)
  download.file(
    url,
    destfile = path
  )
  unzip(path, exdir = "data/mh/")
}
```

That extracted all the data and Mplus files to `data/` in the project root. We then wrangle the main data file and save for our analyses:

```{r}
#| label: mh-wrangle

d <- read_csv(
  "data/mh/Data/Two-Level Data.csv", 
  col_names = c("urge", "dep", "js", "hs", "person", "time")
) %>% 
  select(
    person, time, js, hs, urge, dep
  ) |> 
  mutate(
    person = factor(person),
    time = as.integer(time-1)
  )
write_rds(d, "data/mcneish-hamaker.rds")
```

Our second dataset, analyzed in the manuscript, is from @beyens2020. Below, we download & wrangle then save it for later analyses.

```{r data-process}
# The data is cited in the paper as "The dataset generated and analysed during the current study is available in Figshare." (https://uvaauas.figshare.com/articles/dataset/Dataset_belonging_to_Beyens_et_al_2020_The_effect_of_social_media_on_well-being_differs_from_adolescent_to_adolescent/12497990)

# Download data if not yet downloaded
path <- "data/beyens-et-al-2020.sav"
if (!file.exists(path)) {
  dir.create("data", FALSE)
  # Data from figshare
  download.file(
    "https://uvaauas.figshare.com/ndownloader/files/24028271", 
    path
  )
  # Code from OSF
  download.file(
    "https://files.de-1.osf.io/v1/resources/bvfuw/providers/osfstorage/5df9effa64e19d000d0f51da/?zip=",
    "data/Analyses.zip"
  )
  unzip(
    "data/Analyses.zip",
    exdir = "data/Analyses"
  )
}

# Active, Passive, and Total were sums of the platform (e.g. whatsapp) times
d <- read_spss(path) %>% 
  mutate(
    class = factor(ClassNr),
    person = factor(EthicaID),
    time = (OccNrR - 1),
    sm = rowSums(select(., contains("Pas"), contains("Pas")), na.rm = TRUE) / 60,
    happy = as.numeric(AffWB) / 7, 
    .keep = "none"
  ) %>% 
  arrange(person, class, time)

# Sum scores exceeding 60minutes (i.e., less than 2.5% of all occasions per subscale) were recoded to 60 minutes. (Beyens et al. p.9)
d$sm <- if_else(d$sm > 1.0, 1.0, d$sm)

# Lag well-being
d <- d %>% 
  mutate(
    happy_lag = lag(happy),
    .by = person
  )

write_rds(d, "data/beyens-etal.rds")
```
